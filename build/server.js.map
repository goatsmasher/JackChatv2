{"version":3,"sources":["webpack:///webpack/bootstrap 7b60258ae2b5a33f04cf","webpack:///./src/server/server.js","webpack:///external \"source-map-support/register\"","webpack:///./src/shared/operators.js","webpack:///external \"rxjs\"","webpack:///external \"express\"","webpack:///external \"http\"","webpack:///external \"socket.io\"","webpack:///external \"chalk\"","webpack:///./src/shared/observable-socket.js","webpack:///./src/server/modules/users.js","webpack:///external \"lodash\"","webpack:///./src/server/lib/module.js","webpack:///./src/shared/validation/users.js","webpack:///./src/shared/validator.js","webpack:///./src/server/modules/playlist.js","webpack:///./src/server/modules/chat.js","webpack:///external \"webpack-dev-middleware\"","webpack:///external \"webpack-hot-middleware\"","webpack:///external \"webpack\"","webpack:///./webpack.client.js","webpack:///external \"path\"","webpack:///external \"extract-text-webpack-plugin\"","webpack:///./src/shared/validation/chat.js"],"names":["isDevelopment","process","env","NODE_ENV","app","server","Server","io","USE_WEBPACK","webpackMiddleware","require","webpackHotMiddleware","webpack","clientConfig","compiler","use","publicPath","stats","colors","chunks","assets","modules","timings","hash","version","console","log","bgRed","set","static","useExternalStyles","get","req","res","render","videoServices","playlistRepository","users","chat","playlist","on","socket","request","connection","remoteAddress","client","mod","registerClient","clientRegistered","port","PORT","startServer","listen","merge","map","m","init$","subscribe","complete","error","prototype","safeSubscribe","next","subscription","item","e","stack","unsubscribe","catchWrap","catch","of","clientMessage","fail","success","message","Error","throw","successObservable","empty","ObservableSocket","_state","isConnected","isReconnecting","_socket","_actionCallbacks","_requests","_nextRequestId","status$","on$","attempt","isTotallyDead","publishReplay","refCount","state","event","fromEvent","callback","off","arg","emit","action","id","_registerCallbacks","subject","hasOwnProperty","_popRequest","requestId","value","hasValue","_emitError","actions","onAction","AuthContext","Symbol","UsersModule","_io","_userList","_users","username","reduce","ch","charCodeAt","Math","abs","hue","saturation","lightness","auth","isLoggedIn","trim","validator","isValid","throw$","name","color","getColorForUsername","push","getUserForClient","index","indexOf","splice","onActions","loginClient$","logoutClient$","ModuleBase","validateLogin","USERNAME_REGEX","length","test","Validator","_errors","join","errors","PlaylistModule","usersModule","_repository","_services","MAX_HISTORY","BATCH_SIZE","ChatModule","_chatLog","user","type","newMessage","time","Date","getTime","sendMessage","path","ExtractTextPlugin","dirname","resolve","vendorModules","createConfig","isDebug","devTool","plugins","optimize","CommonsChunkPlugin","cssLoader","loader","sassLoader","appEntry","UglifyJsPlugin","extract","HotModuleReplacementPlugin","devtool","entry","application","vendor","output","filename","alias","shared","module","loaders","exclude","exports","create","validateSendMessage","MESSAGE_TYPES","includes"],"mappings":"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","file":"server.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 7b60258ae2b5a33f04cf","import \"source-map-support/register\";\r\nimport \"shared/operators\";\r\nimport express from \"express\";\r\nimport http from \"http\";\r\nimport socketIo from \"socket.io\";\r\nimport chalk from \"chalk\";\r\nimport { Observable } from \"rxjs\";\r\nimport { ObservableSocket } from \"shared/observable-socket\";\r\nimport { UsersModule } from \"./modules/users\";\r\nimport { PlaylistModule } from \"./modules/playlist\";\r\nimport { ChatModule } from \"./modules/chat\";\r\n\r\nconst isDevelopment = process.env.NODE_ENV !== \"production\";\r\n\r\n// Setup\r\nconst app = express(),\r\n    server = new http.Server(app),\r\n    io = socketIo(server);\r\n\r\n// Client Webpack\r\nif (process.env.USE_WEBPACK === \"true\") {\r\n    var webpackMiddleware = require(\"webpack-dev-middleware\"),\r\n        webpackHotMiddleware = require(\"webpack-hot-middleware\"),\r\n        webpack = require(\"webpack\"),\r\n        clientConfig = require(\"../../webpack.client\");\r\n\r\n    const compiler = webpack(clientConfig);\r\n    app.use(webpackMiddleware(compiler, {\r\n        publicPath: \"/build/\",\r\n        stats: {\r\n            colors: true,\r\n            chunks: false,\r\n            assets: false,\r\n            modules: false,\r\n            timings: false,\r\n            hash: false,\r\n            version: false\r\n        }\r\n    }));\r\n    app.use(webpackHotMiddleware(compiler));\r\n\r\n    console.log(chalk.bgRed(\"Using WebPack Dev Middleware!!! FOR DEV ENVIRONMENT ONLY\"));\r\n}\r\n\r\n// Configure Express\r\napp.set(\"view engine\", \"jade\");\r\napp.use(express.static(\"public\"));\r\n\r\nconst useExternalStyles = !isDevelopment;\r\napp.get(\"/\", (req, res) => {\r\n    res.render(\"index\", {\r\n        useExternalStyles\r\n    });\r\n});\r\n\r\n// Services\r\nconst videoServices = [];\r\nconst playlistRepository = {};\r\n\r\n// Modules\r\nconst users = new UsersModule(io);\r\nconst chat = new ChatModule(io, users);\r\nconst playlist = new PlaylistModule(io, users, playlistRepository, videoServices);\r\nconst modules = [users, chat, playlist];\r\n\r\n// Socket\r\nio.on(\"connection\", socket => {\r\n    console.log(`Got connection from ${socket.request.connection.remoteAddress}`);\r\n\r\n    const client = new ObservableSocket(socket);\r\n    for (let mod of modules) {\r\n        mod.registerClient(client);\r\n    }\r\n    for (let mod of modules) {\r\n        mod.clientRegistered(client);\r\n    }\r\n});\r\n\r\n// Startup\r\nconst port = process.env.PORT || 3000;\r\nfunction startServer() {\r\n    server.listen(port, () =>\r\n        console.log(`Started http server on ${port}`));\r\n}\r\n\r\nObservable.merge(...modules.map(m => m.init$()))\r\n    .subscribe({\r\n        complete() {\r\n            startServer();\r\n        },\r\n        error(error) {\r\n            console.error(`Could not init module: $(error.stack || error}`);\r\n        }\r\n    });\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/server/server.js","module.exports = require(\"source-map-support/register\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"source-map-support/register\"\n// module id = 1\n// module chunks = 0","import {Observable} from \"rxjs\";\r\n\r\nObservable.prototype.safeSubscribe = function(next, error, complete) {\r\n    const subscription = this.subscribe(\r\n        item => {\r\n            try {\r\n                next(item);\r\n            } catch (e) {\r\n                console.error(e.stack || e);\r\n                subscription.unsubscribe();\r\n            }\r\n        },\r\n        error,\r\n        complete);\r\n    return subscription;\r\n};\r\n\r\nObservable.prototype.catchWrap = function() {\r\n    return this.catch(error => Observable.of({error: error}));\r\n};\n\n\n// WEBPACK FOOTER //\n// ./src/shared/operators.js","module.exports = require(\"rxjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"rxjs\"\n// module id = 3\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"http\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"http\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"socket.io\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"socket.io\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"chalk\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"chalk\"\n// module id = 7\n// module chunks = 0","import { Observable, ReplaySubject } from \"rxjs\";\r\n\r\nexport function clientMessage(message) {\r\n    const error = new Error(message);\r\n    error.clientMessage = message;\r\n    return error;\r\n}\r\n\r\nexport function fail(message) {\r\n    return Observable.throw({clientMessage: message});\r\n}\r\n\r\nlet successObservable = Observable.empty();\r\nexport function success() {\r\n    return successObservable;\r\n}\r\n\r\nexport class ObservableSocket {\r\n\r\n    get isConnected() { return this._state.isConnected; }\r\n    get isReconnecting() { return this._state.isReconnecting; }\r\n    get isTotallyDead() { return !this.isConnected && !this.isReconnecting; }\r\n\r\n    constructor(socket) {\r\n        this._socket = socket;\r\n        this._state = {};\r\n        this._actionCallbacks = {};\r\n        this._requests = {};\r\n        this._nextRequestId = 0;\r\n\r\n        this.status$ = Observable.merge(\r\n            this.on$(\"connect\").map(() => ({ isConnected: true })),\r\n            this.on$(\"disconnect\").map(() => ({ isConnected: false })),\r\n            this.on$(\"reconnecting\").map(attempt => ({ isConnected: false, isReconnecting: true, attempt })),\r\n            this.on$(\"reconnect_failed\").map(() => ({ isTotallyDead: true })))\r\n            .publishReplay(1)\r\n            .refCount();\r\n\r\n        this.status$.subscribe(state => this._state = state);\r\n    }\r\n    // Basic Wrappers\r\n    on$(event) {\r\n        return Observable.fromEvent(this._socket, event);\r\n    }\r\n    on(event, callback) {\r\n        this._socket.on(event, callback);\r\n    }\r\n    off(event, callback) {\r\n        this._socket.off(event, callback);\r\n    }\r\n    emit(event, arg) {\r\n        this._socket.emit(event, arg);\r\n    }\r\n\r\n    emitAction$(action, arg) {\r\n        const id = this._nextRequestId++;\r\n        this._registerCallbacks(action);\r\n\r\n        const subject = this._requests[id] = new ReplaySubject(1);\r\n        this._socket.emit(action, arg, id);\r\n        return subject;\r\n\r\n    }\r\n    _registerCallbacks(action) {\r\n        if (this._actionCallbacks.hasOwnProperty(action)) {\r\n            return;\r\n        }\r\n\r\n        this._socket.on(action, (arg, id) => {\r\n            const request = this._popRequest(id);\r\n            if (!request) {\r\n                return;\r\n            }\r\n            request.next(arg);\r\n            request.complete();\r\n        });\r\n\r\n        this._socket.on(`${action}:fail`, (arg, id) => {\r\n            const request = this._popRequest(id);\r\n            if (!request) {\r\n                return;\r\n            }\r\n            request.error(arg);\r\n        });\r\n\r\n        this._actionCallbacks[action] = true;\r\n    }\r\n    _popRequest(id) {\r\n        if (!this._requests.hasOwnProperty(id)) {\r\n            console.error(`No such ID exists in _requests - ${id}`);\r\n            return;\r\n        }\r\n        const request = this._requests[id];\r\n        delete this._requests[id];\r\n        return request;\r\n    }\r\n\r\n\r\n    onAction(action, callback) {\r\n        this._socket.on(action, (arg, requestId) => {\r\n            try {\r\n                const value = callback(arg);\r\n                if (!value) {\r\n                    this._socket.emit(action, null, requestId);\r\n                    return;\r\n                }\r\n\r\n                if (typeof (value.subscribe) !== \"function\") {\r\n                    this._socket.emit(action, value, requestId);\r\n                    return;\r\n                }\r\n\r\n                let hasValue = false;\r\n                value.subscribe({\r\n                    next: (item) => {\r\n                        if (hasValue) {\r\n                            throw new Error(`Action ${action} produced more than one value.`);\r\n                        }\r\n                        this._socket.emit(action, item, requestId);\r\n                        hasValue = true;\r\n                    },\r\n                    error: (error) => {\r\n                        this._emitError(action, requestId, error);\r\n                        console.error(error.stack || error);\r\n                    },\r\n                    complete: () => {\r\n                        if (!hasValue) {\r\n                            this._socket.emit(action, null, requestId);\r\n                        }\r\n                    }\r\n                });\r\n\r\n            } catch (error) {\r\n                if (typeof (requestId) !== \"undefined\") {\r\n                    this._emitError(action, requestId, error);\r\n                }\r\n                console.error(error.stack || error);\r\n            }\r\n        });\r\n    }\r\n\r\n    onActions(actions) {\r\n        for (let action in actions) {\r\n            if (!actions.hasOwnProperty(action)) {\r\n                continue;\r\n            }\r\n            this.onAction(action, actions[action]);\r\n        }\r\n    }\r\n\r\n    _emitError(action, id, error) {\r\n        const message = (error && error.clientMessage) || \"Fatal Error\";\r\n        this._socket.emit(`${action}:fail`, { message }, id);\r\n    }\r\n\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/observable-socket.js","import _ from \"lodash\";\r\nimport { ModuleBase } from \"../lib/module\";\r\nimport { validateLogin } from \"shared/validation/users\";\r\nimport { fail } from \"shared/observable-socket\";\r\nimport { Observable } from \"rxjs\";\r\n\r\nconst AuthContext = Symbol(\"AuthContext\");\r\n\r\nexport class UsersModule extends ModuleBase {\r\n    constructor(io) {\r\n        super();\r\n        this._io = io;\r\n        this._userList = [];\r\n        this._users = {};\r\n    }\r\n\r\n    getColorForUsername(username) {\r\n        let hash = _.reduce(username,\r\n            (hash, ch) => ch.charCodeAt(0) + (hash << 6) + (hash << 16) - hash, 0);\r\n        hash = Math.abs(hash);\r\n        const hue = hash % 360,\r\n            saturation = hash % 25 + 70,\r\n            lightness = 100 - (hash % 15 + 35);\r\n\r\n        return `hsl(${hue}, ${saturation}%, ${lightness}%)`;\r\n    }\r\n\r\n    getUserForClient(client) {\r\n        const auth = client[AuthContext];\r\n        if (!auth) {\r\n            return null;\r\n        }\r\n        return auth.isLoggedIn ? auth : null;\r\n    }\r\n\r\n    loginClient$(client, username) {\r\n        username = username.trim();\r\n\r\n        const validator = validateLogin(username);\r\n        if (!validator.isValid) {\r\n            return validator.throw$();\r\n        }\r\n        if (this._users.hasOwnProperty(username)) {\r\n            return fail(`Username ${username} is already taken`);\r\n        }\r\n\r\n        const auth = client[AuthContext] || (client[AuthContext] = {});\r\n        if (auth.isLoggedIn) {\r\n            return fail(\"You are already logged in\");\r\n        }\r\n        auth.name = username;\r\n        auth.color = this.getColorForUsername(username);\r\n        auth.isLoggedIn = true;\r\n\r\n        this._users[username] = client;\r\n        this._userList.push(auth);\r\n\r\n        this._io.emit(\"users:added\", auth);\r\n        return Observable.of(auth);\r\n    }\r\n\r\n    logoutClient$(client) {\r\n        const auth = this.getUserForClient(client);\r\n        if (!auth) {\r\n            return;\r\n        }\r\n        const index = this._userList.indexOf(auth);\r\n        this._userList.splice(index, 1);\r\n        delete this._users[auth.name];\r\n        delete client[AuthContext];\r\n\r\n        this._io.emit(\"users:removed\", auth);\r\n    }\r\n\r\n    registerClient(client) {\r\n        client.onActions({\r\n            \"users:list\": () => {\r\n                return this._userList;\r\n            },\r\n            \"auth:login\": ({ name }) => {\r\n                return this.loginClient$(client, name);\r\n            },\r\n            \"auth:logout\": () => {\r\n                this.logoutClient$(client);\r\n            }\r\n        });\r\n        client.on(\"disconnect\", () => {\r\n            this.logoutClient$(client);\r\n        });\r\n    }\r\n\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/users.js","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 10\n// module chunks = 0","import { Observable } from \"rxjs\";\r\n\r\nexport class ModuleBase {\r\n    init$() {\r\n        return Observable.empty();\r\n    }\r\n\r\n    registerClient(client) {\r\n\r\n    }\r\n    clientRegistered(client) {\r\n\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/lib/module.js","import {Validator} from \"../validator\";\r\n\r\nexport let USERNAME_REGEX = /^[\\w\\d_-]+$/;\r\n\r\nexport function validateLogin(username) {\r\n    const validator = new Validator();\r\n\r\n    if (username.length >= 20){\r\n        validator.error(\"Username must be fewer than 20 characters\");\r\n    }\r\n    if (!USERNAME_REGEX.test(username)) {\r\n        validator.error(\"Username can only contain letters, numbers, underscores and dashes\");\r\n    }\r\n    return validator;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validation/users.js","import { Observable } from \"rxjs\";\r\n\r\nexport class Validator {\r\n    get isValid() { return !this._errors.length; }\r\n    get errors() { return this._errors; }\r\n    get message() { return this._errors.join(\", \");}\r\n\r\n    constructor() {\r\n        this._errors = [];\r\n    }\r\n\r\n    error(message) {\r\n        this._errors.push(message);\r\n    }\r\n\r\n    toObject() {\r\n        if(this.isValid){\r\n            return {};\r\n        }\r\n        return {\r\n            errors: this._errors,\r\n            message: this.message\r\n        };\r\n    }\r\n\r\n    throw$() {\r\n        return Observable.throw({\r\n            clientMessage: this.message\r\n        });\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validator.js","import {ModuleBase} from \"../lib/module\";\r\n\r\nexport class PlaylistModule extends ModuleBase {\r\n    constructor(io, usersModule, playlistRepository, videoServices) {\r\n        super();\r\n        \r\n        this._io = io;\r\n        this._users = usersModule;\r\n        this._repository = playlistRepository;\r\n        this._services = videoServices;\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/playlist.js","import { ModuleBase } from \"../lib/module\";\r\nimport { validateSendMessage } from \"shared/validation/chat\";\r\nimport { fail } from \"shared/observable-socket\";\r\n\r\nconst MAX_HISTORY = 250;\r\nconst BATCH_SIZE = 25;\r\n\r\nexport class ChatModule extends ModuleBase {\r\n    constructor(io, usersModule) {\r\n        super();\r\n        this._io = io;\r\n        this._users = usersModule;\r\n        this._chatLog = [];\r\n    }\r\n\r\n    sendMessage(user, message, type) {\r\n        message = message.trim();\r\n        const validator = validateSendMessage(user, message, type);\r\n        if (!validator.isValid) {\r\n            return validator.throw$();\r\n        }\r\n        const newMessage = {\r\n            user: { name: user.name, color: user.color },\r\n            message: message,\r\n            time: new Date().getTime(),\r\n            type: type\r\n        };\r\n        this._chatLog.push(newMessage);\r\n\r\n        if (this._chatLog.length >= MAX_HISTORY) {\r\n            this._chatLog.splice(0, BATCH_SIZE);\r\n        }\r\n        this._io.emit(\"chat:added\", newMessage);\r\n    }\r\n\r\n    registerClient(client) {\r\n        client.onActions({\r\n            \"chat:list\": () => {\r\n                return this._chatLog;\r\n            },\r\n            \"chat:add\": ({ message, type }) => {\r\n                type = type || \"normal\";\r\n\r\n                const user = this._users.getUserForClient(client);\r\n                if (!user) {\r\n                    return fail(\"You must be logged in\");\r\n                }\r\n                else {\r\n                    this.sendMessage(user, message, type);\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/server/modules/chat.js","module.exports = require(\"webpack-dev-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-dev-middleware\"\n// module id = 16\n// module chunks = 0","module.exports = require(\"webpack-hot-middleware\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack-hot-middleware\"\n// module id = 17\n// module chunks = 0","module.exports = require(\"webpack\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"webpack\"\n// module id = 18\n// module chunks = 0","var path = require(\"path\"),\r\n    webpack = require(\"webpack\"),\r\n    ExtractTextPlugin = require(\"extract-text-webpack-plugin\");\r\n\r\nconst dirname = path.resolve(\"./\");\r\nconst vendorModules = [\"jquery\",\"lodash\", \"socket.io-client\", \"rxjs\"];\r\n\r\nfunction createConfig(isDebug) {\r\n    const devTool = isDebug ? \"eval-source-map\" : \"source-map\";\r\n    const plugins = [new webpack.optimize.CommonsChunkPlugin(\"vendor\", \"vendor.js\")];\r\n\r\n    const cssLoader = { test: /\\.css$/, loader: \"style!css\" };\r\n    const sassLoader = { test: /\\.scss$/, loader: \"style!css!sass\" };\r\n    const appEntry = [\"./src/client/application.js\"];\r\n\r\n    if (!isDebug) {\r\n        plugins.push(new webpack.optimize.UglifyJsPlugin());\r\n        plugins.push(new ExtractTextPlugin(\"[name].css\"));\r\n\r\n        cssLoader.loader = ExtractTextPlugin.extract(\"style\", \"css\");\r\n        sassLoader.loader = ExtractTextPlugin.extract(\"style\", \"css!sass\");\r\n    }\r\n    else {\r\n        plugins.push(new webpack.HotModuleReplacementPlugin());\r\n        appEntry.splice(0,0, \"webpack-hot-middleware/client\");\r\n    }\r\n\r\n    //webpack config\r\n    return {\r\n        devtool: devTool,\r\n        entry: {\r\n            application: appEntry,\r\n            vendor: vendorModules\r\n        },\r\n        output: {\r\n            path: path.join(dirname, \"public\", \"build\"),\r\n            filename: \"[name].js\",\r\n            publicPath: \"/build/\"\r\n        },\r\n        resolve: {\r\n            alias: {\r\n                shared: path.join(dirname, \"src\", \"shared\")\r\n            }\r\n        },\r\n        module: {\r\n            loaders: [\r\n                { test: /\\.js$/, loader: \"babel\", exclude: /node_modules/ },\r\n                { test: /\\.js$/, loader: \"eslint\", exclude: /node_modules/ },\r\n                { test: /\\.(png|jpg|jpeg|gif|woff|ttf|eot|svg|woff2)/, loader: \"url-loader?limit=1024\" },\r\n                cssLoader,\r\n                sassLoader\r\n\r\n            ]\r\n        },\r\n        plugins: plugins\r\n    };\r\n}\r\n\r\nmodule.exports = createConfig(true);\r\nmodule.exports.create = createConfig;\n\n\n// WEBPACK FOOTER //\n// ./webpack.client.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 20\n// module chunks = 0","module.exports = require(\"extract-text-webpack-plugin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"extract-text-webpack-plugin\"\n// module id = 21\n// module chunks = 0","import _ from \"lodash\";\r\nimport {Validator} from \"../validator\";\r\n\r\nexport let MESSAGE_TYPES = [\"normal\"];\r\n\r\nexport function validateSendMessage(user, message, type) {\r\n    const validator = new Validator();\r\n\r\n    if (message.length > 50) {\r\n        validator.error(\"Message must be smaller 50 characters\");\r\n    } \r\n    if (!_.includes(MESSAGE_TYPES, type)){\r\n        validator.error(`Invalid message type: ${type}`);\r\n    }\r\n    if (message.trim().length === 0 ){\r\n        validator.error(\"Message cannot be blank\");\r\n    }\r\n\r\n    return validator;\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/shared/validation/chat.js"],"sourceRoot":""}